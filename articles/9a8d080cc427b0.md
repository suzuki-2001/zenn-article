---
title: "浮動小数点型で比較して誤差で沼った話"
emoji: "😎"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["Atcoder","cpp"]
published: true
---

コンテスト参加時のちょっとしたメモです。

# 問題
[ABC 308 C-Standings](https://atcoder.jp/contests/abc308/tasks/abc308_c)


# 沼ったところ
この問題ではコイントスの成功率を比較する必要があります。
ここで問題文のままに浮動小数点型で比較すると、誤差が生じてしまい複数のテストケースでWAになります。

```cpp
sort(ans.begin(), ans.end(), [](const pair<double, int64_t>& a, const pair<double, int64_t>& b) {
    if (a.first != b.first) return a.first > b.first;
    else return a.second < b.second;
});
```

誤差が考えられる問題で、強引に比較しようとしたため、なかなかテストケースを通すことができませんでした。

# 解決策
整数型で比較できるように、`a[i]*(a[j] + b[j]）`と`a[j]*(a[i] + b[i])`を比較します。
このように分母を払って変換することで整数型で比較できる様になります。

こちらに公式の[解法](https://atcoder.jp/contests/abc308/editorial/6689)があります。


# 得られた教訓
ここで重要だったのは、問題文を見たときに誤差を考える必要があることに瞬時に気づくことと、少数のテストケースでWAになったことを見て、バグの原因に当たりをつけることでした。

[こちらの記事](https://qiita.com/e869120/items/8be6521e72025d7b2a13)にバグ解消のTipsがまとめられています。